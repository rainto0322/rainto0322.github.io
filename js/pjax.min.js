class Pjax{static defaultOptions={timeout:3e3,contain:"main",before:()=>{},after:()=>{}};constructor(e={}){if(typeof window!="object"||!window)return;if(typeof history.pushState!="function")return;this.lastPathname={},this.options={...Pjax.defaultOptions,...e},this.container=document.querySelector(this.options.contain),this.handleClick=this.handleClick.bind(this),this.handlePopstate=this.handlePopstate.bind(this),document.addEventListener("click",this.handleClick),window.addEventListener("popstate",this.handlePopstate)}handleClick(e){const t=e.target.closest&&e.target.closest("a");if(!t)return;if(e.button!==0)return;if(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;if(t.target==="_blank"||t.target==="_top")return;if(t.hasAttribute("no-pjax"))return;if(history.replaceState({scroll:window.scrollY},"",location.href),history.pushState({},"",t.href),t.pathname===location.pathname&&t.hash){this.lastPathname=new URL(location.href);return}e.preventDefault(),this.lastPathname=new URL(location.href),this.loadPage(t.href)}handlePopstate(e){if(console.log(location.hash),(location.hash||this.lastPathname.hash)&&location.pathname===this.lastPathname.pathname)return;this.lastPathname=new URL(location.href);const{scroll:t}=e.state??{};this.loadPage(location.href,t)}async loadPage(e,t=0){try{const{timeout:a,contain:r,before:c,after:l}=this.options;c();const s=new AbortController,d=setTimeout(()=>s.abort(),a),u=await fetch(e,{signal:s.signal});clearTimeout(d);const h=await u.text(),o=(new DOMParser).parseFromString(h,"text/html"),n=o.querySelector(r);if(!n){console.error("PJAX: target container not found in response");return}this.container.innerHTML=n.innerHTML;const i=o.querySelector("title");i&&(document.title=i.innerText);const m=n.querySelectorAll("script");if(m.forEach(e=>{const t=document.createElement("script");e.src?(t.src=e.src,t.async=!1):t.textContent=e.textContent,document.body.appendChild(t),document.body.removeChild(t)}),e.hash){const t=document.querySelector(decodeURIComponent(e.hash));t instanceof HTMLElement&&(t.scrollIntoView(),offsetScroll())}else setTimeout(()=>{window.scrollTo({top:t,behavior:"auto"})},10);l()}catch(t){window.location.replace("/404.html"),t.name==="AbortError"?console.error(`Request timeout ${timeout} ms: ${e}`):console.error(t.message||t)}}}